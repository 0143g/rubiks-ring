<!DOCTYPE html>
<html>
<head>
    <title>GAN Cube → WSL Bridge</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .connected { background: #d4edda; border: 1px solid #c3e6cb; }
        .disconnected { background: #f8d7da; border: 1px solid #f5c6cb; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; height: 300px; overflow-y: scroll; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>GAN Cube → WSL Bridge</h1>
    
    <div id="status" class="status disconnected">
        Status: Disconnected
    </div>
    
    <button id="connectCube">Connect GAN Cube</button>
    <button id="connectWS">Connect to WSL (ws://localhost:8080)</button>
    <button id="disconnect">Disconnect</button>
    
    <h3>Event Log:</h3>
    <div id="log" class="log"></div>

    <script type="module">
        // Import the GAN cube library (you'll need to serve this from gan-web-bluetooth/dist/)
        // For now, using a simplified version - replace with actual library import
        
        let cubeConnection = null;
        let websocket = null;
        
        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message, connected = false) {
            statusDiv.textContent = `Status: ${message}`;
            statusDiv.className = `status ${connected ? 'connected' : 'disconnected'}`;
        }
        
        // WebSocket connection to WSL Node.js server
        function connectWebSocket() {
            try {
                websocket = new WebSocket('ws://localhost:8080');
                
                websocket.onopen = () => {
                    log('Connected to WSL WebSocket server');
                    updateStatus('WebSocket Connected', true);
                };
                
                websocket.onclose = () => {
                    log('WebSocket connection closed');
                    updateStatus('WebSocket Disconnected', false);
                };
                
                websocket.onerror = (error) => {
                    log(`WebSocket error: ${error}`);
                };
                
            } catch (error) {
                log(`Failed to connect WebSocket: ${error}`);
            }
        }
        
        // Send data to WSL via WebSocket
        function sendToWSL(data) {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                websocket.send(JSON.stringify(data));
            }
        }
        
        // GAN Cube connection (simplified - replace with actual gan-web-bluetooth import)
        async function connectGANCube() {
            try {
                log('Requesting GAN cube connection...');
                
                // This is a placeholder - you'll need to replace with actual gan-web-bluetooth import
                // For testing, we'll simulate cube events
                log('NOTE: Replace this with actual gan-web-bluetooth library import');
                log('Simulating cube connection...');
                
                // Simulate successful connection
                setTimeout(() => {
                    log('GAN cube connected (simulated)');
                    updateStatus('Cube Connected', true);
                    
                    // Simulate some face rotations
                    const moves = ['R', "R'", 'U', "U'", 'F', "F'", 'L', "L'", 'D', "D'", 'B', "B'"];
                    let moveIndex = 0;
                    
                    setInterval(() => {
                        const move = moves[moveIndex % moves.length];
                        moveIndex++;
                        
                        const event = {
                            type: 'MOVE',
                            move: move,
                            timestamp: Date.now()
                        };
                        
                        log(`Cube move detected: ${move}`);
                        sendToWSL(event);
                    }, 2000);
                    
                }, 1000);
                
                /* 
                // Actual gan-web-bluetooth code would look like this:
                const { connectGanCube } = await import('./gan-web-bluetooth/dist/esm/index.mjs');
                
                cubeConnection = await connectGanCube();
                log('GAN cube connected successfully!');
                updateStatus('Cube Connected', true);
                
                cubeConnection.events$.subscribe((event) => {
                    if (event.type === "MOVE") {
                        log(`Cube move: ${event.move}`);
                        sendToWSL({
                            type: 'MOVE',
                            move: event.move,
                            face: event.face,
                            direction: event.direction,
                            timestamp: Date.now()
                        });
                    } else if (event.type === "FACELETS") {
                        log('Cube state updated');
                        sendToWSL({
                            type: 'FACELETS',
                            facelets: event.facelets,
                            timestamp: Date.now()
                        });
                    }
                });
                
                // Request initial cube state
                await cubeConnection.sendCubeCommand({ type: "REQUEST_FACELETS" });
                */
                
            } catch (error) {
                log(`Failed to connect to GAN cube: ${error}`);
                updateStatus('Cube Connection Failed', false);
            }
        }
        
        function disconnect() {
            if (cubeConnection) {
                cubeConnection.disconnect();
                cubeConnection = null;
            }
            
            if (websocket) {
                websocket.close();
                websocket = null;
            }
            
            log('Disconnected');
            updateStatus('Disconnected', false);
        }
        
        // Event listeners
        document.getElementById('connectCube').addEventListener('click', connectGANCube);
        document.getElementById('connectWS').addEventListener('click', connectWebSocket);
        document.getElementById('disconnect').addEventListener('click', disconnect);
        
        log('Bridge interface loaded. Connect to WSL first, then connect cube.');
    </script>
</body>
</html>